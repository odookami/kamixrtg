<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="stock_valuation_layer_tree_inherit_bmo_mrp_cost" model="ir.ui.view">
            <field name="name">stock.valuation.layer.tree.inherit.bmo_mrp_cost</field>
            <field name="model">stock.valuation.layer</field>
            <field name="inherit_id" ref="stock_account.stock_valuation_layer_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='uom_id']" position="after">
                    <field name="unit_cost" />
                    <field name="unit_cost_new" />
                </xpath>
            </field>
        </record>>
        <record id="stock_valuation_layer_form_inherit_bmo_mrp_cost" model="ir.ui.view">
            <field name="name">stock.valuation.layer.form.inherit</field>
            <field name="model">stock.valuation.layer</field>
            <field name="inherit_id" ref="stock_account.stock_valuation_layer_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='unit_cost']" position="after">
                    <field name="unit_cost_new" />
                </xpath>
            </field>
        </record>

        <menuitem 
            id="stock_account.menu_valuation" 
            name="Inventory Valuation" 
            parent="stock.menu_warehouse_report" 
            sequence="110" 
            action="stock_account.stock_valuation_layer_action"
            groups="bmo_inventory.group_inventory_stock_valuation"/>

        <record id='view_mrp_cost_tree' model='ir.ui.view'>
            <field name="name">mrp.cost.tree</field>
            <field name="model">mrp.cost</field>
            <field name="arch" type="xml">
                <tree string="Landed Costs">
                    <field name="name"/>
                    <field name="tipe"/>
                    <field name="select_month"/>
                    <field name="select_year"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id='view_mrp_cost_form' model='ir.ui.view'>
            <field name="name">mrp.cost.form</field>
            <field name="model">mrp.cost</field>
            <field name="arch" type="xml">
                <form string="Landed Costs">
                    <header>
                        <button name="button_validate" string="Validate" states="draft" class="oe_highlight" type="object"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <label for="name" class="oe_edit_only"/>
                            <h1>
                                <field name="name" placeholder="Landed Cost Name" />
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="tipe" required="1" attrs="{'readonly' : [('state','!=','draft')]}"/>
                                <label for="select_month" string="Period"/>
                                <div>
                                    <field name="select_month" class="oe_inline" required="1"/>
                                    -
                                    <field name="select_year" class="oe_inline" nolabel="1" required="1"/>
                                </div>
                            </group>
                            <group>
                                <field name="period_id" invisible="1"/>
                                <field name="batch_ids" widget="many2many_tags" readonly="1"/>
                            </group>
                            <group>
                                <field name="last_stock_manual" groups="bmo_mrp_cost.group_mrp_manul_last_stock"/>
                            </group>
                        </group>
                        <separator string="Cost Lines"/>
                        <p class="oe_grey">
                        </p>
                        <field name="cost_lines" attrs="{'readonly' : [('state','!=','draft')]}">
                            <form string="Cost Lines">
                                <group>
                                    <group>
                                        <field name="product_id" domain="[('type', '=', 'service')]"/>
                                        <field name="price_unit"/>
                                    </group>
                                </group>
                                <label for="name"/>
                                <field name="name"/>
                            </form>
                            <tree string="Cost Lines" editable="bottom">
                                <field name="product_id" domain="[('type', '=', 'service')]" options="{'no_create_edit': True,'no_create' : True}"/>
                                <field name="price_unit" widget="monetary"/>
                            </tree>
                        </field>
                        <group class="oe_subtotal_footer oe_right">
                            <field name="amount_total" widget="monetary"/>
                            <button colspan="2" name="compute_mrp_cost" string="Compute" type="object" class="oe_right btn-secondary" states='draft'/>
                        </group>

                        <div class="oe_clear"/>
                        <separator string="Valuation Adjustments"/>
                        <field name="valuation_adjustment_lines">
                            <tree string="Valuation Adjustments" editable="bottom" create="0" delete="0">
                                <field name="product_id" readonly="1"/>
                                <field name="machine_usage_time" readonly="1"/>
                                <field name="allocation_ratio_origin" invisible="1"/>
                                <field name="allocation_ratio" readonly="1"/>
                                <field name="allocation_fee" readonly="1" />
                                <field name="consum_wip" readonly="1"/>
                                <field name="cost_wip" readonly="1"/>
                                <field name="biaya_wip" readonly="1"  attrs="{'column_invisible': [('parent.tipe', '=', 'Mixing')]}"/>
                                <field name="production_result" readonly="1"/>
                                <field name="cost_per_unit" readonly="1" />
                                <field name="last_stock_manual" invisible="1"/>
                                <field name="Last_month_stock" attrs="{'readonly' : [('last_stock_manual', '!=', True)]}"/>
                                <field name="Last_month_cost" attrs="{'readonly' : [('last_stock_manual', '!=', True)]}"/>
                                <field name="pmac" readonly="1"/>
                                <field name="result_pmac_prod" readonly="1"/>
                                <field name="lot_ids" widget="many2many_tags" invisible="1"/>
                                <field name="mrp_ids" widget="many2many_tags" invisible="1"/>
                            </tree>
                            <form>
                                <sheet>
                                    <group>
                                        <field name="product_id" readonly="1"/>
                                        <field name="machine_usage_time" readonly="1"/>
                                    </group>
                                    <group string="Cost">
                                        <group>
                                            <field name="allocation_ratio_origin" readonly="1"/>
                                            <field name="allocation_ratio" readonly="1"/>
                                            <field name="allocation_fee" readonly="1" />
                                        </group>
                                        <group>
                                            <field name="consum_wip" readonly="1"/>
                                            <field name="cost_wip" readonly="1"/>
                                            <field name="biaya_wip" readonly="1" attrs="{'column_invisible': [('parent.tipe', '=', 'Mixing')]}"/>
                                        </group>
                                        <group>
                                            <field name="production_result" readonly="1"/>
                                            <field name="cost_per_unit" readonly="1" />
                                            <field name="last_stock_manual" invisible="1"/>
                                        </group>
                                        <group>
                                            <field name="Last_month_stock" attrs="{'readonly' : [('last_stock_manual', '!=', True)]}"/>
                                            <field name="Last_month_cost" attrs="{'readonly' : [('last_stock_manual', '!=', True)]}"/>
                                        </group>
                                    </group>
                                    <group>
                                        <field name="pmac" readonly="1"/>
                                        <field name="result_pmac_prod" readonly="1"/>
                                    </group>
                                    <notebook>
                                        <page name="mrp" string="MRP">
                                            <field name="mrp_ids" readonly="1">
                                                <tree>
                                                    <field name="okp_id"/>
                                                    <field name="tipe" invisible="0"/>
                                                    <field name="goods_qty" sum="Jumlah"/>
                                                    <field name="reject_qty" sum="Jumlah"/>
                                                    <field name="sampling_qty" sum="Jumlah"/>
                                                    <field name="sampling_ex_qty" sum="Jumlah"/>
                                                    <field name="sampling_marketing_qty" attrs="{'invisible' : [('tipe','!=','Banded')]}" sum="Jumlah"/>
                                                    <field name="state"/>
                                                </tree>
                                            </field>
                                        </page>
                                        <page string="Stock Move">
                                            <field name="stock_move_ids" readonly="1">
                                                <tree>
                                                    <field name="product_id" />
                                                    <field name="product_uom_qty" sum="Qty"/>
                                                    <field name="quantity_done" sum="Qty"/>
                                                    <field name="product_uom"/>
                                                    <field name="state" />
                                                </tree>
                                            </field>
                                        </page>
                                        <page name="lot" string="Lot">
                                            <field name="lot_ids" readonly="1">
                                                <tree>
                                                    <field name="name" />
                                                </tree>
                                            </field>
                                        </page>
                                    </notebook>
                                </sheet>
                            </form>
                        </field>
                        <group>
                            <group>
                                <field name="machine_usage_time" readonly="1"/>
                                <field name="allocation_ratio" readonly="1"/>
                                <field name="consum_wip" readonly="1"/>
                            </group>
                            <group>
                                <field name="allocation_fee" readonly="1"/>
                                <field name="biaya_wip" readonly="1"/>
                                <field name="production_result" readonly="1"/>
                                <field name="result_pmac_prod" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="mrp_cost_view_search" model="ir.ui.view">
            <field name="name">mrp.cost.view.search</field>
            <field name="model">mrp.cost</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name" filter_domain="['|', ('name','ilike',self), ('tipe','ilike',self)]" string="Period"/>
                    <filter string="To Draft" name="draft" domain="[('state','=','draft')]" icon="terp-dialog-close"/>
                    <filter string="To Posted" name="done" domain="[('state','=','done')]" icon="terp-dialog-close"/>

                </search>
            </field>
        </record>

        <!-- <record id="view_stock_landed_cost_search" model="ir.ui.view">
            <field name="name">stock.landed.cost.search</field>
            <field name="model">stock.landed.cost</field>
            <field name="arch" type="xml">
                <search string="Landed Costs">
                    <field name="name" string="Name"/>
                    <field name="date"/>
                    <separator/>
                    <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Done" name="done" domain="[('state','=','done')]"/>
                    <group expand="0" string="Group By">
                        <filter string="Date" name="group_by_month" context="{'group_by': 'date'}"/>
                        <filter string="Status" name="status" context="{'group_by': 'state'}"/>
                    </group>
                </search>
            </field>
        </record> -->

        <record id='action_mrp_cost' model='ir.actions.act_window'>
            <field name="name">MRP Costs</field>
            <field name="res_model">mrp.cost</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new MRP cost
                </p>
            </field>
        </record>

        <record id="mrp_cost_type_action" model="ir.actions.act_window">
            <field name="name">MRP Cost Types</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.product</field>
            <field name="domain">[('type', '=', 'service')]</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_landed_cost_ok': True, 'default_type': 'service'}</field>
            <field name="search_view_id" ref="product.product_search_form_view"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                Define a new kind of MRP cost
                </p>
            </field>
        </record>

    </data>
</odoo>
